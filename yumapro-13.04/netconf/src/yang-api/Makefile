
# Makefile for NETCONF project
#  
#   src/yang-api directory
#

# make all --> yang-api

############### SOURCE PROFILE ##############################

SUBDIR_NM=yang-api
SUBDIR_CPP=-I../subsys-pro

############### TARGET PROFILE ##############################

# program names
PROG=yang-api

# local targets
SUBSYS_TARGET=$(TBASE)/subsys-pro
TARGET=$(TBASE)/$(SUBDIR_NM)
BIN_INST=$(TBASE)/bin

# real targets
ifdef PACKAGE_BUILD
REAL_INST=$(DESTDIR)/usr/sbin
REAL_INST_USER=root
REAL_INST_GROUP=root
else
REAL_INST=$(DESTDIR)/var/www/yang-api
REAL_INST_USER=www-data
REAL_INST_GROUP=www-data
endif

# objects for the yang-api program
OBJS = $(patsubst %.c,$(TARGET)/%.o,yang_api.c)

# object from the subsys dir to link in
LOBJS = $(SUBSYS_TARGET)/subsystem.o
LOBJS += $(SUBSYS_TARGET)/subsys_util.o


##################### LIBRARIES ########################

# The order of these LIBS matters!
#
# If the linker can't find external symbols you know should
# be there and you get an Unresolved External error 
#   file foo : unresolved external to bar
# Then put the library that contains foo BEFORE the one
# that contains bar. 

LIBS = -lsendbuff -L/usr/local/lib -lfcgi

############## MAKE RULES #################################
ifdef DEVELOPER
all:
else
all: yang-api
endif  # DEVELOPER

#################### PLATFORM DEFINITIONS ############
include ../platform/platform.profile


################ DEPENDENCIES #########################
# depend rule must be included after the 'all' make rule

include ../platform/platform.profile.depend


clean:
	rm -f $(OBJS) $(BIN_INST)/$(PROG)


superclean: clean
	rm -f *~ *.D dependencies

TARGETS=

ifdef PACKAGE_BUILD
TARGETS = package-install
else
 ifndef DEVELOPER
TARGETS = dev-install
 endif # DEVELOPER
endif # PACKAGE_BUILD

# needs to be done by root
install: $(TARGETS)

dev-install:
	mkdir -p $(REAL_INST)
ifdef MAC
	install $(OWNER) $(GRP) $(BIN_INST)/$(PROG) $(REAL_INST)
else
	install --owner=$(REAL_INST_USER) --group=$(REAL_INST_GROUP) \
	$(BIN_INST)/$(PROG) $(REAL_INST)
endif

package-install:
	mkdir -p $(REAL_INST)
	install $(OWNER) $(GRP) $(BIN_INST)/$(PROG) $(REAL_INST)

uninstall:
	rm -f  $(REAL_INST)/$(PROG)

distclean: superclean

# this real rule keeps make from deleting the $(OBJS) as
# intermediate files

### the yp-shell raw IO variant is not being used right now
### so it is not built in this Makefile
#subsys-pro: nc-subsys cli-subsys
yang-api: $(OBJS)
	$(LINK) $(CFLAGS) $(LFLAGS) $(OBJS) $(LOBJS) -o $(BIN_INST)/$(PROG) $(LPATH) $(FPATH) $(LIBS)


.PHONY: yang-api dev-install package-install

# prevent the make program from choking on all the symbols
# that get generated from autogenerated make rules
.NOEXPORT:

include ./dependencies
