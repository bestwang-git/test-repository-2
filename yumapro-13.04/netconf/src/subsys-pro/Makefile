# Makefile for NETCONF project
#  
#   src/subsys-pro directory
#

# make all --> netconf-subsystem-pro
# make cli --> yp-rawshell

############### SOURCE PROFILE ##############################

SUBDIR_NM=subsys-pro
SUBDIR_CPP=

############### TARGET PROFILE ##############################

# program names
NC_PROG=netconf-subsystem-pro
CLI_PROG=yp-rawshell

# local targets
TARGET=$(TBASE)/$(SUBDIR_NM)
BIN_INST=$(TBASE)/bin

# real targets
REAL_NC_INST=$(DESTDIR)$(PREFIX)/sbin
REAL_CLI_INST=$(DESTDIR)$(PREFIX)/bin

# common objects for the subsystem code
CMN_OBJS = $(patsubst %.c,$(TARGET)/%.o,subsystem.c)
CMN_OBJS += $(patsubst %.c,$(TARGET)/%.o,subsys_util.c)

# separate object groups for each wrapper to subsystem
NC_OBJS = $(patsubst %.c,$(TARGET)/%.o,netconf-subsystem.c)
CLI_OBJS = $(patsubst %.c,$(TARGET)/%.o,yp-rawshell.c)


##################### LIBRARIES ########################

# The order of these LIBS matters!
#
# If the linker can't find external symbols you know should
# be there and you get an Unresolved External error 
#   file foo : unresolved external to bar
# Then put the library that contains foo BEFORE the one
# that contains bar. 

#LIBS= -lyumapro_ncx -lxml2 -lz -lm
LIBS = -lsendbuff

############## MAKE RULES #################################
ifdef DEVELOPER
all:
else
all: subsys-pro
endif  # DEVELOPER

cli: cli-subsys

#################### PLATFORM DEFINITIONS ############
include ../platform/platform.profile


################ DEPENDENCIES #########################
# depend rule must be included after the 'all' make rule

include ../platform/platform.profile.depend


clean:
	rm -f $(OBJS) $(BIN_INST)/$(NC_PROG) $(BIN_INST)/$(CLI_PROG)


superclean: clean
	rm -f *~ *.D dependencies

# needs to be done by root
install:
ifndef DEVELOPER
	mkdir -p $(REAL_NC_INST)
	install $(OWNER) $(GRP) $(BIN_INST)/$(NC_PROG) $(REAL_NC_INST)
endif

install-cli:
	mkdir -p $(REAL_CLI_INST)
	install $(OWNER) $(GRP) $(BIN_INST)/$(CLI_PROG) $(REAL_CLI_INST)

uninstall:
	rm -f  $(REAL_NC_INST)/$(NC_PROG) $(REAL_CLI_INST)/$(CLI_PROG)

distclean: superclean

# this real rule keeps make from deleting the $(OBJS) as
# intermediate files

### the yp-shell raw IO variant is not being used right now
### so it is not built in this Makefile
#subsys-pro: nc-subsys cli-subsys
subsys-pro: nc-subsys

nc-subsys: $(CMN_OBJS) $(NC_OBJS)
	$(LINK) $(CFLAGS) $(LFLAGS) $(CMN_OBJS) $(NC_OBJS) -o $(BIN_INST)/$(NC_PROG) $(LPATH) $(FPATH) $(LIBS)

cli-subsys: $(CMN_OBJS) $(CLI_OBJS)
	$(LINK) $(CFLAGS) $(LFLAGS) $(CMN_OBJS) $(CLI_OBJS) -o $(BIN_INST)/$(CLI_PROG) $(LPATH) $(FPATH) $(LIBS)


.PHONY: subsys-pro nc-subsys cli-subsys cli install-cli

# prevent the make program from choking on all the symbols
# that get generated from autogenerated make rules
.NOEXPORT:

include ./dependencies
